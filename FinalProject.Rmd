---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r message=FALSE}
library(tidyverse)
library(mosaic)
library(readr)
library(httr)
library(RCurl)
library(lubridate)
```

#Research Question
African Swine fever is a viral disease that has caused major issues for the swine industry in numerous countries, including China, Vietnam, the Phillipines. China, home to half of the world's pigs, has been hit the hardest by African Swine fever. Countries have resorted to slaughtering their livestock and placing bans on transport of livestock in and out of the country. The media has released news about African Swine Fever very recently, but why had this news not come out earlier when these data show the significant shifts of protein imports in numerous countries? We would like to explore whether or not African Swine Fever had a major impact on the swine industry before the media released reports in 2019 and around when this impact occured. 

#Looking at the original files
As seen in the inital importation of the data, many, almost none, of the variables have names that give us information on what is in each column. Furthermore, many of the cases were left as NA due to the format of the csv. So, we will have to re-organize the data into tidy format and rename the variables so that others looking at the data will be able to known what information is contained in the datasets. 
```{r}
#Import in the Livestock monthly data
myFile <- "https://raw.githubusercontent.com/shravanisamala/FinalProject-/master/Livestock%20monthly.csv"
LivestockMonthly <- read_csv(myFile)

head(LivestockMonthly)
glimpse(LivestockMonthly)

#Import in the Livestock yearly data 
myFile2 <- "https://raw.githubusercontent.com/shravanisamala/FinalProject-/master/Livestock%20yearly.csv"
LivestockYearly <- read_csv(myFile2)

head(LivestockYearly)
glimpse(LivestockYearly)

```

#Cleaning up Livestock Monthly and Livestock CSVs
To clean up the Monthly data on livestock, we only included the variables we wanted to work with: Country, Month, and Animal_Imp_or_Exp (in pounds). This format allows us to see the meat import and export differences on a monthly basis for each country. 
```{r}
#Monthly
LivestockMonthlyClean<-
  LivestockMonthly %>%
  filter(row_number() > 1)%>%
  rename('Animal_Imp_or_Exp' = 'Meat and livestock monthly U.S. trade',
         countryCode = X2, 
         country = X3,
         sep_18 = X4,
         oct_18 = X5, 
         nov_18 = X6,
         dec_18 = X7,
         jan_19 = X8, 
         feb_19 = X9, 
         mar_19 = X10,
         apr_19 = X11,
         may_19 = X12, 
         jun_19 = X13, 
         jul_19 = X14, 
         aug_19 = X15, 
         sep_19 = X16)%>%
   filter(countryCode != "Total")%>%
  select(Animal_Imp_or_Exp,country,sep_18,oct_18,nov_18,dec_18,jan_19,feb_19,mar_19,apr_19,may_19,jun_19,jul_19,aug_19,sep_19)%>%
  gather(key = Month, value = Animal_Imp_or_Exp,sep_18,oct_18,nov_18,dec_18,jan_19,feb_19,mar_19,apr_19,may_19,jun_19,jul_19,aug_19,sep_19 ) 


head(LivestockMonthlyClean)

LivestockMonthlyClean

```

#Yearly
To clean up the yearly data for livestock, we renamed each variable so that it showed the amount of meat imported and exported in each year for each country. Then, we converted the data frame into narrow format by including all of the years in one big variable called year. This way, we can hopefully track the movement of meat imports and exports over the years for each country. 
```{r}
LivestockYearlyClean <- 
  LivestockYearly %>%
  filter(row_number() > 1)%>%
  mutate(X4 = as.integer(X4),
         X5 = as.integer(X5),
         X6 = as.integer(X6),
         X7 = as.integer(X7),
         X8 = as.integer(X8),
         X9 = as.integer(X9),
         X10 = as.integer(X10))%>%
  rename(Animal_Imp_or_Exp = 'Meat and livestock annual cumulative year-to-date U.S. trade',
         countryCode = X2, 
         country = X3,
         year2014 = X4,
         year2015 = X5, 
         year2016 = X6,
         year2017 = X7,
         year2018 = X8, 
         jan_sep18 = X9, 
         jan_sep19 = X10)%>%
  filter(countryCode != "Total")%>%
  select(Animal_Imp_or_Exp,country,year2014,year2015,year2016,year2017,year2018,jan_sep19)%>%
  gather(key = year, value = amount_in_1000s, year2014,year2015,year2016,year2017,year2018,jan_sep19)
  






#LivestockYearlyCleanTwo <-
  for(i in 1:nrow(LivestockYearlyClean)){
    j <- i-1
    if(LivestockYearlyClean$Animal_Imp_or_Exp[i] %in% NA){
      LivestockYearlyClean$Animal_Imp_or_Exp[i] <- LivestockYearlyClean$Animal_Imp_or_Exp[j]
    }
  }



LivestockYearlyClean

glimpse(LivestockYearlyClean)      


```

#Look at Yearly total meat movement
Because African Swine Fever caused so much upheaval in the swine industry of many countries, we wanted to see how much the total imports and exports of each country changed over the years. After arranging the sums in descending order, we can see that Canada, Mexico, and Japan had the largest total movement of meat throughout most, if not, all of the years since 2014. When we find China further down in the dataset, we can see that total movement of meat in countries such as China, Vietnam, and the Phillipines has increased through the years because their total movement of mean increases. 
```{r}
Yearly_Movement_Country <- 
  LivestockYearlyClean%>%
  filter(amount_in_1000s > 0)%>%
  group_by(year,country)%>%
  summarise(total_Movement = sum(amount_in_1000s))%>%
  arrange(desc(total_Movement))
  
Yearly_Movement_Country
```

#Protien Movement Global Ranking and change over the past years
As seen in the data analysis above, it appears that Canada imports and exports the most meat out of all of the countries; Mexico also is the runner up from 2014 to 2018. However, after looking at the data for this year, the United Kingdom has taken over Canada's place in the rankings. In fact, Canada and Mexico are no longer in the top ten meat importers and exporters in 2019. As we expected, China, the Phillipines, and Vietnam moved up in the rankings. 
```{r}

Yearly_Movement_2014 <-
  Yearly_Movement_Country %>%
  mutate(the_rank = rank(desc(total_Movement)))%>%
  filter(year == "year2014")%>%
  filter(the_rank < 11.0)
  
Yearly_Movement_2015 <-
  Yearly_Movement_Country %>%
  mutate(the_rank = rank(desc(total_Movement)))%>%
  filter(year == "year2015")%>%
  filter(the_rank < 11.0)

Yearly_Movement_2016 <-
  Yearly_Movement_Country %>%
  mutate(the_rank = rank(desc(total_Movement)))%>%
  filter(year == "year2016")%>%
  filter(the_rank < 11.0)

Yearly_Movement_2017 <-
  Yearly_Movement_Country %>%
  mutate(the_rank = rank(desc(total_Movement)))%>%
  filter(year == "year2017")%>%
  filter(the_rank < 11.0)

Yearly_Movement_2018 <-
  Yearly_Movement_Country %>%
  mutate(the_rank = rank(desc(total_Movement)))%>%
  filter(year == "year2018")%>%
  filter(the_rank < 11.0)

Yearly_Movement_2019 <-
  Yearly_Movement_Country %>%
  mutate(the_rank = rank(desc(total_Movement)))%>%
  filter(year == "jan_sep19")%>%
  filter(the_rank < 11.0)

#Look at yearly data table
Yearly_Movement_2014
Yearly_Movement_2015
Yearly_Movement_2016
Yearly_Movement_2017
Yearly_Movement_2018
Yearly_Movement_2019

```




#Graphics
# Graphics are still a work in progress, both of them so far are basically the same just looking for the best wat=y to exress different countries change in rank over time.

```{r fig.height=8, fig.width=15}

Ten_Countries_data <-
  Yearly_Movement_Country %>%
  filter(country %in% c("Canada","Mexico", "China (Mainland)", "Laos", "Phillipines","South Korea", "Japan", "Vietnam", "Australia", "New Zealand"))
        

Ten_Countries_data

gf_point(total_Movement ~ year, data = Ten_Countries_data, color = ~ country, size =3) %>%
gf_facet_wrap(~ country, ncol = 4) %>% 
gf_theme(legend.position = "right") %>% 
gf_labs(title = "", caption = "")


gf_point(total_Movement ~ country, data = Ten_Countries_data, color = ~ country, size =3, tilt = 50) %>%
gf_facet_wrap(~ year, ncol = 4) %>% 
gf_theme(legend.position = "right") %>% 
gf_labs(title = "", caption = "")
```

```{r}
library(dplyr)

Yearly_Movement_Country_One <-
  Yearly_Movement_Country %>%
  
    group_by(year)%>%
    %>%
    mutate(Rank = rank(desc(total_Movement)))%>%
    filter(Rank < 9)



  ggplot(data = Yearly_Movement_Country_One, aes(x = year, y = total_Movement))+
  geom_point()+
  aes(color = country, size = total_Movement)+
  theme(axis.text.x = element_text(angle = 45))+
  xlab("Year")
  
  

```








